var Gitview=function(e){this.createFrame=function(){var e=dojo.create("div",{"class":"outer",style:"position:relative;text-align:left;line-height:15px;padding:5px 5px 23px 5px;background:"+this.frameColor+";border-radius:5px;width:"+this.w+";"},this.domNode),t=dojo.create("div",{style:"height:100%;width:"+this.w+";"},e),n=dojo.create("a",{"class":"button icon arrowright",style:"float:right;margin-left:5px"},e,"last"),r=dojo.create("a",{"class":"button icon arrowleft",style:"float:right;"},e,"last");dojo.connect(n,"onclick",this,"nextPage"),dojo.connect(r,"onclick",this,"prevPage"),this.domNode=t},this.createFrameHeader=function(e){var t=dojo.create("table",{style:"height:47px;width:100%;border-spacing:0;border-collapse:collapse;margin:0px;padding:0px;"},this.domNode,"before"),n=dojo.create("tr",{},t),r=dojo.create("td",{style:"width:41px;vertical-align:top;padding:0px;"},n),i=dojo.create("td",{style:"padding:0px;"},n);dojo.create("img",{src:e.avatar_url,style:"width:40px;height:auto;border-radius:2px;position:relative;"},r),dojo.create("span",{innerHTML:e.login+"<br>",style:'font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;font-size:13px;color:white;font-weight:bold;margin-left:6px'},i);var s=dojo.create("span",{innerHTML:e.followers+" follower",style:'font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;font-size:12px;color:#AAA;margin-left:6px'},i);if(e.followers>1||e.followers==0)s.innerHTML+="s";var o=dojo.create("span",{innerHTML:" - "+e.public_repos+" repositor",style:'font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;font-size:12px;color:#AAA;'},i);e.public_repos>1||e.public_repos==0?o.innerHTML+="ies":o.innerHTML+="y";var u=dojo.create("span",{innerHTML:"compact",style:'font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;font-size:10px;color:#AAA;cursor:hand;cursor:pointer;margin-left:5px;position:absolute;top:38px;right:27px'},this.domNode,"before"),a=dojo.create("span",{innerHTML:"full",style:'font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;font-size:10px;color:#AAA;cursor:hand;cursor:pointer;position:absolute;top:38px;right:7px'},this.domNode,"before");dojo.connect(a,"onclick",this,"toggleFull"),dojo.connect(u,"onclick",this,"toggleCompact")},this.createRepoEntry=function(e,t){if(!e.fork||e.fork&&this.showForks){var n=dojo.create("div",{"class":"entry",style:"text-align:left;border:1px solid #DDD;border-radius:4px;margin-bottom:5px;background:white;"},this.domNode);this.entries.push(n),this.frame||dojo.style(n,"width",this.w),this.compact&&dojo.style(n,"marginBottom","5px"),this._index>=this.count&&dojo.style(n,"display","none");var r=this.createTop(e,n);this.tops.push(r);var i=this.createBottom(e,n);this.bottoms.push(i),this._index++}},this.createTop=function(e,t){var n=dojo.create("div",{"class":"top",style:"height:32px;line-height:38px;border-bottom:1px solid #DDD;"},t);this.compact&&dojo.style(n,"borderBottom","0px");var r=e.fork?"http://logicalcognition.com/files/gitviewFiles/fork.png":"https://a248.e.akamai.net/assets.github.com/images/icons/public.png";dojo.create("img",{src:r,style:"margin-left:6px"},n);var i=dojo.create("a",{innerHTML:e.name,href:"https://github.com/"+this.user+"/"+e.name,style:"color:#4183C4;font-size:14px;font-weight:bold;font-family:arial;position:relative;top:-3px;margin-left:6px;text-decoration:none"},n);dojo.connect(i,"onmouseover",function(e){dojo.style(e.target,"textDecoration","underline")}),dojo.connect(i,"onmouseout",function(e){dojo.style(e.target,"textDecoration","none")});var s=dojo.create("div",{style:"display:inline-block;float:right;color:#666;font-size:11px;font-family:arial;font-weight:bold;"},n);e.language&&dojo.create("span",{innerHTML:e.language,style:"position:relative;top:-3px;"},s);var o=dojo.create("a",{innerHTML:'<img src="http://logicalcognition.com/files/gitviewFiles/repostat_watchers.png"/>&nbsp;<font color="#666;">'+e.watchers+"</font>",href:"https://github.com/"+this.user+"/"+e.name+"/watchers",style:"position:relative;top:-3px;margin-left:10px;text-decoration:none;"},s),u=dojo.create("a",{innerHTML:'<img src="http://logicalcognition.com/files/gitviewFiles/repostat_forks.png"/>&nbsp;<font color="#666;">'+e.forks+"</font>",href:"https://github.com/"+this.user+"/"+e.name+"/network",style:"position:relative;top:-3px;margin-left:10px;text-decoration:none;margin-right:15px"},s);return n},this.createBottom=function(e,t){var n=dojo.create("div",{"class":"bottom",style:"border-bottom-right-radius:3px;border-bottom-left-radius:3px;padding-bottom:5px;padding-top:5px"},t);dojo.isWebKit?dojo.style(n,"backgroundImage","-webkit-gradient(linear, 0% 0%, 0% 100%, from(#FAFAFA), to(#EFEFEF))"):dojo.isFF&&dojo.style(n,"background","-moz-linear-gradient(center top , #FAFAFA, #EFEFEF) repeat scroll 0 0 transparent");var r=e.description;r.length>100&&(r=r.slice(0,97)+"...");var i=dojo.create("div",{innerHTML:r,style:"font:12px arial;margin-left:10px;height:30px"},n),s=dojo.create("div",{innerHTML:"Last updated "+this.fixUpdateDate(e.pushed_at),style:"font:11px arial;color:#888;margin-top:5px;margin-left:10px;"},n);this._tmpW||(this._tmpW=t.offsetWidth-35+"px");var o=new Gitgraph({user:this.user,repo:e.name,domNode:n,width:this._tmpW});return dojo.style(o,"marginLeft","auto"),dojo.style(o,"marginRight","auto"),dojo.style(o,"marginTop","5px"),dojo.style(o,"marginBottom","5px"),this.compact&&dojo.style(n,"display","none"),n},this.toggleFull=function(){this.bottoms.forEach(function(e){dojo.style(e,"display","block")}),this.tops.forEach(function(e){dojo.style(e,"borderBottom","1px solid #DDD1px solid #DDD")})},this.toggleCompact=function(){this.bottoms.forEach(function(e){dojo.style(e,"display","none")}),this.tops.forEach(function(e){dojo.style(e,"borderBottom","0px")})},this.nextPage=function(){var e=this._pageMax;this._pageMax=this._pageMax+this.count<=this._repoCount?this._pageMax+this.count:this._repoCount;var t=this._pageMax;if(e!=t)for(var n=0;n<this.entries.length;n++)n<e?dojo.style(this.entries[n],"display","none"):n<t&&dojo.style(this.entries[n],"display","block")},this.prevPage=function(){var e=0;dojo.forEach(this.entries,function(t){dojo.style(t,"display")!="none"&&e++}),this._pageMax=this._pageMax-e>=this.count?this._pageMax-e:this.count;var t=this._pageMax,n=this._pageMax-this.count>=0?this._pageMax-this.count:0;if(t!=n||t!=0)for(var r=0;r<this.entries.length;r++)r>=t?dojo.style(this.entries[r],"display","none"):r>=n&&dojo.style(this.entries[r],"display","block")},this.fixUpdateDate=function(e){return e},this.loadRepos=function(){var t=JSON.parse(this.store.get("repo_data_"+this.user));if(t&&this.cache){this.repos=t,this.sortRepos(this.repos),this._index=0,this._pageMax=this.count;for(var n=0;n<this.repos.length;n++)this.createRepoEntry(this.repos[n]);this._repoCount=dojo.query(".entry").length}else dojo.io.script.get({url:"https://api.github.com/users/"+e.user+"/repos",callbackParamName:"callback",load:dojo.hitch(this,function(e){this.repos=e.data,this.sortRepos(this.repos);var t=JSON.stringify(e.data);this.store.set("repo_data_"+this.user,t),this._index=0,this._pageMax=this.count;for(var n=0;n<this.repos.length;n++)this.createRepoEntry(this.repos[n]);this._repoCount=dojo.query(".entry").length}),error:function(e){console.error(e)}})},this.loadUser=function(){var t=JSON.parse(this.store.get("user_data_"+this.user));t&&this.cache?(this.createFrame(),this.createFrameHeader(t),this.loadRepos()):dojo.io.script.get({url:"https://api.github.com/users/"+e.user,callbackParamName:"callback",load:dojo.hitch(this,function(e){this.createFrame();var t=JSON.stringify(e.data);this.store.set("user_data_"+this.user,t),this.createFrameHeader(e.data),this.loadRepos()}),error:function(e){console.error(e)}})},this.loadScript=function(e,t){var n=document.getElementsByTagName("head")[0];if(n){var r=document.createElement("script");r.setAttribute("src",e),r.setAttribute("type","text/javascript");var i=function(){(this.readyState=="complete"||this.readyState=="loaded")&&t()};r.onreadystatechange=i,r.onload=t,n.appendChild(r)}},this.loadTemplate=function(e){var t=document.createElement("link");t.href=e,t.type="text/css",t.rel="stylesheet",t.media="screen",document.getElementsByTagName("head")[0].appendChild(t)},this.sortRepos=function(e){e.sort(function(e,t){var n=new Date(e.pushed_at),r=new Date(t.pushed_at);return n<r?-1:n>r?1:0}),e.reverse()},this.bind=function(e){if(typeof this!="function")throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,r=function(){},i=function(){return n.apply(this instanceof r?this:e||window,t.concat(Array.prototype.slice.call(arguments)))};return r.prototype=this.prototype,i.prototype=new r,i},this.bootstrap=function(){window.dojo?this.kickStart.bind(this)():this.loadScript("http://ajax.googleapis.com/ajax/libs/dojo/1.7.1/dojo/dojo.js",this.kickStart.bind(this))},this.kickStart=function(){dojo.require("dojo.io.script"),dojo.ready(this,function(){this.store=new Persist.Store("Gitview"),this.loadTemplate("http://logicalcognition.com/files/gitviewFiles/gh-buttons.css"),this.frame?this.loadUser():this.loadRepos()})};if(!e||!e.user)throw new Error("Gitview: missing user and/or domNode arg");this.user=e.user,this.domNode=e.domNode?e.domNode:document.body,this.compact=e.compact==1?!0:!1,this.frame=e.noFrame==1?!1:!0,this.showForks=e.showForks==0?!1:!0,this.cache=e.cache==0?!1:!0,this.count=e.count?e.count:3,this.w=e.width?e.width:"440px",this.w=this.w.substring(0,this.w.length-2)<300?"350px":this.w,this.frameColor=e.frameColor?e.frameColor:"#444",this.repos=[],this.entries=[],this.bottoms=[],this.tops=[],Function.prototype.bind||(Function.prototype.bind=this.bind),this.loadScript("http://logicalcognition.com/Projects/persist-js/persist-min.js",function(){this.loadScript("http://logicalcognition.com/Projects/Gitgraph/Gitgraph.js",this.bootstrap.bind(this))}.bind(this))};window.jQuery&&(jQuery.fn.gitview=function(e){if(!e||!e.user)throw new Error("Gitview: missing user arg");this.each(function(){var t=new Gitview({user:e.user,domNode:$(this)[0],compact:e.compact==1?!0:!1,noFrame:e.noFrame==1?!0:!1,cache:e.cache==0?!1:!0,showForks:e.showForks==0?!1:!0,count:e.count?e.count:3,width:e.width?e.width:"440px",frameColor:e.frameColor?e.frameColor:"#444"})})});