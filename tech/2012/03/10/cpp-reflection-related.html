<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
      <!-- Always force latest IE rendering engine (even in intranet) &amp; Chrome Frame -->
    </meta>
    <meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
      <!--[if lt IE 9]>
        <script src='http://html5shim.googlecode.com/svn/trunk/html5.js' type='text/javascript'></script>
      <![endif]-->
    </meta>
    <meta content='width=device-width, initial-scale=1.0' name='viewport' />
    <title>C++ Reflection 相关</title>
    <link href="/stylesheets/site.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="/stylesheets/blog.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="/stylesheets/highlight/sunburst.css" media="screen" rel="stylesheet" type="text/css" />
    
  </head>
  <body class=''>
    <div id='container'>
      <div id='main' role='main'>
        <aside class='sidebar'>
          <nav>
            <span>
              <a href='/tech/'>home</a>
            </span>
            <span>
              <a href='/tech/calendar.html'>calendar</a>
            </span>
            <span>
              <a href='/tech/tags.html'>tags</a>
            </span>
          </nav>
        </aside>
        
        <div class='content'>
          <header>
            <div class='article_nav'>
              <span class='later'>
                <a href='/tech/2012/06/10/async_io.html'>
                  < 更新
                </a>
              </span>
              <span class='earlier'>
                <a href='/tech/2012/02/25/notes-on-framework-process-pattern.html'>
                  更早 >
                </a>
              </span>
            </div>
            <h1>
              C++ Reflection 相关
            </h1>
          </header>
          <article>
            <blockquote>
<p>2012年9月按：序言最初我是用英文写的，其对应的中文表述如下：</p>

<p>对于C++反射，我关心的使用领域包括：</p>

<ul>
<li>模版元编程可以解决的那一部分编译时反射</li>
<li>运行时反射在实现IoC、ORM等中可以让程序员写得更惬意的语法糖衣、DSL</li>
<li>在类Rspec测试和Mock中所需要的对于被测程序非侵入式的信息获取和校验</li>
</ul>
</blockquote>

<p>从 <a href="http://www.garret.ru/cppreflection/docs/reflect.html">http://www.garret.ru/cppreflection/docs/reflect.html</a> ， 我们可以了解到在C++中达成反射的基本方法：
For C++ reflection, I&#39;m interested in the following senarios:</p>

<ul>
<li>Compile-time reflection that can be implemented by meta-template programming</li>
<li>Run-time reflection that can form syntactic sugar and DSL to help developers to implement IoC, ORM etc.</li>
<li>Non-intrusive information extraction and validation in testing and mocking, just like Rspec and Mocha in Ruby. </li>
</ul>

<p>From <a href="http://www.garret.ru/cppreflection/docs/reflect.html">http://www.garret.ru/cppreflection/docs/reflect.html</a>, we can know the common approaches to implement reflection in C++.</p>
<table class='table table-bordered table-striped table-condensed'>
  <thead>
    <tr>
      <th>Approach</th>
      <th>Advantages</th>
      <th>Disadvantages</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Parse debugging information</td>
      <td>
        <ul>
          <li>
            Program should not be changed
          </li>
          <li>It is possible to extract complete information about types used in the programs</li>
        </ul>
      </td>
      <td>
        <ul>
          <li>
            Program was build with enabled debugging support and distributed with debugging
            information
          </li>
          <li>
            There are a lot of different formats of storing debug information, while there are some
            standards for formats of executable files (COFF, ELF,...) format of debugging information
            usually is more or less specific to the particular compiler
          </li>
        </ul>
      </td>
    </tr>
    <tr>
      <td>Special preprocessor which will parse C++ sources and build class descriptors</td>
      <td>
        <ul>
          <li>Program should not be changed</li>
        </ul>
      </td>
      <td>
        <ul>
          <li>
            Alignment and offset of fields in classes, as well as virtual function table format
            and naming conventions are specific to each compiler, so it is not possible to create generic
            preprocessor which will produce type information directly. Instead of it, it should generate some
            C++ code, which should be later processed by normal C++ compiler. So build procedure
            becomes too complex.
          </li>
          <li>
            Parsing of C++ code is not trivial task. Also to be able to modify preprocessed code,
            this tool should fully handle standard C++ preprocessor directives and has to be
            called with the same options as normal compiler.
          </li>
        </ul>
      </td>
    </tr>
    <tr>
      <td>Create specialized compiler which will support reflection</td>
      <td>
        <ul>
          <li>
            This is most convenient case for the user - no extra steps during
            build are required to produce runtime type information.
          </li>
          <li>
            Compiler can generate efficient code for reflection methods
          </li>
        </ul>
      </td>
      <td>
        <ul>
          <li>
            Creating own C++ compiler is very challenged task.
          </li>
          <li>
            Users will still prefer to use their own favorite tools (Visual C++, Borland,...).
            It is mostly because most of the modern compiler are not only compilers but IDE with
            builtin editor, debugger, profiler, wizards, class libraries....
          </li>
        </ul>
      </td>
    </tr>
    <tr>
      <td>Let programmer to provide this information himself</td>
      <td>
        <ul>
          <li>
            This is the most portable approach which can be used with any C++ compiler
          </li>
          <li>
            This approach is the simplest to implement
          </li>
          <li>
            With this approach it is possible to include additional type information
            (user defined attributes, for example
            <i>
              transient
              <i>
                )
              </i>
            </i>
          </li>
        </ul>
      </td>
      <td>
        <ul>
          <li>
            Program has to be changed
          </li>
          <li>
            Programmer has to do more work
          </li>
          <li>
            There is a chance for programmer to make mistake describing class format
          </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<ul>
<li><p><a href="https://github.com/tegesoft/camp">camp - C++ multi-purpose reflection library</a> </p></li>
<li><p><a href="http://lcgapp.cern.ch/project/architecture/ReflectionPaper.pdf">Reflection support by means of template metaprogramming</a></p></li>
<li><p><a href="http://www.extreme.indiana.edu/reflcpp/">XCppRefl - C++ Reflection Library</a></p></li>
<li><p><a href="http://root.cern.ch/drupal/content/reflex">Reflex - </a></p></li>
<li><p><a href="https://svn.boost.org/trac/boost/wiki/LibrariesUnderConstruction#ReflectiveProgramming">Boost Reflective Programming</a></p></li>
<li><p><a href="http://kifri.fri.uniza.sk/%7Echochlik/mirror-lib/html/doxygen/mirror/html/examples.html">Boost.Mirror</a></p></li>
</ul>
            <section class='meta'>
              <p>
                <span class='author'>
                  <a href='/'>宋皿</a>
                </span>
                <span class='time'>
                  <time datetime='2012-03-10T00:00:00+00:00'>
                    2012-03-10
                  </time>
                </span>
              </p>
              <p>
                <span class='license'>
                  Published under
                  <a href='http://creativecommons.org/licenses/by-nc-nd/3.0/' rel='license'>(CC) BY-NC-ND</a>
                </span>
                <span class='tags'>
                  tagged with
                  <a href='/tech/tags.html#tag-cpp'>
                    cpp
                  </a>
                  <a href='/tech/tags.html#tag-test'>
                    test
                  </a>
                </span>
              </p>
            </section>
            <div id='disqus_thread'></div>
            <script type='text/javascript'>
              //<![CDATA[
                /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                var disqus_shortname = 'utensil-at-github'; // required: replace example with your forum shortname
                /* * * DON'T EDIT BELOW THIS LINE * * */
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
              //]]>
            </script>
            <a class='dsq-brlink' href='http://disqus.com'>
              comments powered by
              <span class='logo-disqus'>Disqus</span>
            </a>
          </article>
        </div>
      </div>
    </div>
    <script src="/javascripts/jquery-1.7.1.js" type="text/javascript"></script>
    <script src="/javascripts/highlight.pack.js" type="text/javascript"></script>
    <script type='text/javascript'>
      //<![CDATA[
        hljs.initHighlightingOnLoad();
        $(document).ready(function() {          
          $('pre code').each(function(i, e) {hljs.highlightBlock(e)});
        });
      //]]>
    </script>
    
  </body>
</html>

